<!DOCTYPE html>
<html lang="zh"><head><meta charset="utf-8"><title>Hippo's Blog - Android</title><link rel="stylesheet" href="http://seven332.github.io/theme/css/main.css"><link href="http://seven332.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Hippo's Blog RSS Feed"><!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]--></head><body id="index" class="home"><header id="banner" class="body"><h1><a href="http://seven332.github.io/">Hippo's Blog </a></h1><nav><ul><li class="active"><a href="http://seven332.github.io/category/android.html">Android</a></li><li><a href="http://seven332.github.io/category/wu.html">无</a></li></ul></nav></header><aside id="featured" class="body"><article><h1 class="entry-title"><a href="http://seven332.github.io/resolveactivity-de-zhong-yao-xing.html">resolveActivity 的重要性</a></h1><footer class="post-info"><abbr class="published" title="2015-10-08T21:18:00+08:00"> 发表于：15-10-08 21 Thu </abbr><p> 作者： <a class="url fn" href="http://seven332.github.io/author/hippo.html">Hippo</a></p><p>分类： <a href="http://seven332.github.io/category/android.html">Android</a></p></footer><p>在 Android Developers 发的视频 <a href="https://www.youtube.com/watch?v=HGElAW224dE">Protecting Implicit Intents with Runtime Checks (Android Development Patterns Ep 1)</a> 中看到了自己以前犯过的一个错误，就是没有处理 Implicit Intents 导致的 ActivityNotFoundException 异常。</p><p>每当需要用 Implicit Intents 的时候我就会想，用户不可能连这个都没装吧，这是 Android L 的新特性，有系统应用支持肯定不会有问题的。结果都出问题了。可能是用户真的没有安装这类应用，譬如用户用的是模拟器什么类的特殊平台，或者有什么权限的限制。看到错误日志之后，我就直接获取 ActivityNotFoundException，然后忽略。但这并不是一个好的处理方式，因为 ActivityNotFoundException 继承的是 RuntimeException。没有人会不做边界检查直接捕获 IndexOutOfBoundsException。这时候 <a href="http://developer.android.com/reference/android/content/pm/PackageManager.html#resolveActivity(android.content.Intent, int)">resolveActivity</a> 的重要性就体出来了。只需要调用再看看返回值是否为 null 就行了。</p><p><a href="http://seven332.github.io/resolveactivity-de-zhong-yao-xing.html#disqus_thread">来看评论</a></p></article></aside><section id="content" class="body"><h1>其他文章</h1><hr><ol id="posts-list" class="hfeed"><li><article class="hentry"><header><h1><a href="http://seven332.github.io/switchpreference-zai-pre-l-xia-de-bug.html" rel="bookmark" title="Permalink to SwitchPreference 在 pre-L 下的 bug">SwitchPreference 在 pre-L 下的 bug</a></h1></header><div class="entry-content"><footer class="post-info"><abbr class="published" title="2015-09-29T16:15:00+08:00"> 发表于：15-09-29 16 Tue </abbr><p> 作者： <a class="url fn" href="http://seven332.github.io/author/hippo.html">Hippo</a></p><p>分类： <a href="http://seven332.github.io/category/android.html">Android</a></p></footer><p>在 <a href="https://github.com/seven332/Nimingban">Nimingban</a> 这个应用中，最开始我是把暗色主题用 SwitchPreference 放在设置界面里的，而且是第一项。后来有用户反馈说是把设置往下滑动，会出现界面闪烁。我听后感觉很奇怪，因为我这不能重现这个 bug，而且设置界面这方面的代码我也没有用什么奇技淫巧，想必不太可能是我的锅。既然不是我的锅那么就是系统的锅了。好在这个问题貌似只是几个用户会遇到，我也就没太注意，直接在设置中删掉暗色主题的设置，移到右侧栏的下面，自认为完美地解决了这个问题。</p><p>后来又看到有用户反馈说随着设置界面的滑动，设置项的值会变化。看来这个问题并没有被解决。想想看肯定还是系统的问题。查询了一番果然是系统的问题，而且 lollipop 以下的都有这个问题。这个问题已经有人在 stackoverflow 上<a href="http://stackoverflow.com/questions/15632215/preference-items-being-automatically-re-set">问了</a>，而且提交了 <a href="https://code.google.com/p/android/issues/detail?id=26194">issue</a>。</p><p>问题的原因在提交的 issue 里描述的很清楚。PreferenceFragment 用的是 ListView，ListView 会对控件重复使用，问题就出现在重复使用的过程中。</p><p>kitkat-mr2.2-release (API 19) SwitchPreference 相关片段</p><div class="highlight"><pre><span class="kd">private ...</span></pre></div><a class="readmore" href="http://seven332.github.io/switchpreference-zai-pre-l-xia-de-bug.html">来看更多</a><p><a href="http://seven332.github.io/switchpreference-zai-pre-l-xia-de-bug.html#disqus_thread">来看评论</a></p></div></article></li><li><article class="hentry"><header><h1><a href="http://seven332.github.io/android-dateformat-guan-yu-xiao-shi-de-jie-xi.html" rel="bookmark" title="Permalink to Android DateFormat 关于小时的解析">Android DateFormat 关于小时的解析</a></h1></header><div class="entry-content"><footer class="post-info"><abbr class="published" title="2015-09-29T15:00:00+08:00"> 发表于：15-09-29 15 Tue </abbr><p> 作者： <a class="url fn" href="http://seven332.github.io/author/hippo.html">Hippo</a></p><p>分类： <a href="http://seven332.github.io/category/android.html">Android</a></p></footer><p>这是以前写的文章。</p><p>这是以前遇到的问题，具体可以在<a href="https://github.com/seven332/EhViewer/issues/16">这里</a>看到。今天不想做别的事所以又研究了下。</p><p>我本来是想弄个显示时间的控件，记得 Android 本身就有个 TextClock 就直接拿过来用了。结果这个是 JELLY_BEAN_MR1（API 17） 的时候加入的。为了兼容旧的 Android 本版，我直接把 TextClock 的代码拷贝了一份修改了下就能用了。</p><p>后来有看到别人发的截图，时间显示的是 HH:什么什么。我当时没有注意。后来有人发个了 issue，我才开始注意这个问题。</p><p>JELLY_BEAN_MR1（API 17） TextClock 默认解析格式是</p><div class="highlight"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">DEFAULT_FORMAT_12_HOUR</span> <span class="o">=</span> <span class="s">&quot;h:mm aa&quot;</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">CharSequence</span> <span class="n">DEFAULT_FORMAT_24_HOUR</span> <span class="o">=</span> <span class="s">&quot;k ...</span></pre></div><a class="readmore" href="http://seven332.github.io/android-dateformat-guan-yu-xiao-shi-de-jie-xi.html">来看更多</a><p><a href="http://seven332.github.io/android-dateformat-guan-yu-xiao-shi-de-jie-xi.html#disqus_thread">来看评论</a></p></div></article></li></ol></section><section id="extras" class="body"><div class="blogroll"><h2>友情链接</h2><ul><li><a href="#">无</a></li></ul></div><div class="social"><h2>社交</h2><ul><li><a href="http://seven332.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li><li><a href="http://github.com/seven332">github</a></li></ul></div></section><footer id="contentinfo" class="body"><address id="about" class="vcard body"> 自豪地采用 <a href="http://getpelican.com/">Pelican</a>，多谢 <a href="http://python.org">Python</a></address><p>该主题修改自 <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">notmyidea</a></p></footer><script type="text/javascript">
    var disqus_shortname = 'seven332';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script></body></html>