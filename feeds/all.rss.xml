<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>Hippo's Blog</title><link>http://seven332.github.io/</link><description></description><lastBuildDate>Tue, 10 Oct 2017 10:47:00 +0800</lastBuildDate><item><title>Windows 文件名限制</title><link>http://seven332.github.io/windows-wen-jian-ming-xian-zhi.html</link><description>&lt;p&gt;如果要在 Windows 下创建文件，或者可能将在其他操作系统下创建的文件拷贝至 Windows，就需要考虑 Windows 的文件名限制。否则程序会出错，用户会不高兴。&lt;/p&gt;
&lt;h1&gt;文件夹与文件&lt;/h1&gt;
&lt;p&gt;文件夹就是文件，所以两者的限制是一样的。&lt;/p&gt;
&lt;h1&gt;限制&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;保留字符&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;\&amp;lt; （小于）&lt;/li&gt;
&lt;li&gt;&gt; （大于）&lt;/li&gt;
&lt;li&gt;\: （冒号）&lt;/li&gt;
&lt;li&gt;\" （引号）&lt;/li&gt;
&lt;li&gt;\/ （斜杠）&lt;/li&gt;
&lt;li&gt;\ （反斜杠）&lt;/li&gt;
&lt;li&gt;| （束杠）&lt;/li&gt;
&lt;li&gt;\? （问号）&lt;/li&gt;
&lt;li&gt;* （星号）&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;值为 0~31 的字符不可出现。似乎某些字符是允许出现的，不过目前我无法确实有哪些，并且是否在所有流行的 Windows 版本中都适用。谨慎些的话，可以把这些都排除了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CON&lt;/code&gt;，&lt;code&gt;PRN&lt;/code&gt;，&lt;code&gt;AUX&lt;/code&gt;，&lt;code&gt;NUL&lt;/code&gt;，&lt;code&gt;COM1&lt;/code&gt;，&lt;code&gt;COM2&lt;/code&gt;，&lt;code&gt;COM3&lt;/code&gt;，&lt;code&gt;COM4&lt;/code&gt;，&lt;code&gt;COM5&lt;/code&gt;，&lt;code&gt;COM6&lt;/code&gt;，&lt;code&gt;COM7&lt;/code&gt;，&lt;code&gt;COM8&lt;/code&gt;，&lt;code&gt;COM9&lt;/code&gt;，&lt;code&gt;LPT1&lt;/code&gt;，&lt;code&gt;LPT2 …&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Tue, 10 Oct 2017 10:47:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2017-10-10:/windows-wen-jian-ming-xian-zhi.html</guid></item><item><title>自然排序</title><link>http://seven332.github.io/zi-ran-pai-xu.html</link><description>&lt;h1&gt;怎么排序&lt;/h1&gt;
&lt;p&gt;有一个文件夹，里面有一堆图片，漫画浏览器需要知道哪个是第一张，哪个是第二张，对于压缩包也是这样。这就是个排序问题。&lt;/p&gt;
&lt;p&gt;我用的方法就是直接&lt;code&gt;Arrays.sort(array)&lt;/code&gt;或者&lt;code&gt;Collections.sort(list)&lt;/code&gt;，也就是直接使用 String 中 char 的值来进行排序。&lt;/p&gt;
&lt;p&gt;在图片命名即为规范的情况下，这是没有问题的。譬如：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;0001.jpg
0002.jpg
0003.jpg
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然而在其他情况下就会出问题。譬如：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nazo-no-kanojo-ekkusu-1.jpg
nazo-no-kanojo-ekkusu-11.jpg
nazo-no-kanojo-ekkusu-2.jpg
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;显然，&lt;code&gt;nazo-no-kanojo-ekkusu-2.jpg&lt;/code&gt;应该排在&lt;code&gt;nazo-no-kanojo-ekkusu-11.jpg&lt;/code&gt;前面的，而该排序算法做不到这点。问题出在了数字部分的比较。用户不可能按照理想情况，来对数字用零填充，使所有数字位数相同。那么需要对字符串中的数字部分单独处理 …&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Mon, 25 Sep 2017 11:30:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2017-09-25:/zi-ran-pai-xu.html</guid></item><item><title>在静态函数中使用匿名类可避免内存泄漏</title><link>http://seven332.github.io/zai-jing-tai-han-shu-zhong-shi-yong-ni-ming-lei-ke-bi-mian-nei-cun-xie-lou.html</link><description>&lt;p&gt;虽然 JLS 上说匿名类永远不是静态的，但放到静态函数中的话，他爹实例的引用就不存在了，效果和静态类一样，写起来也方便。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Sun, 14 May 2017 16:27:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2017-05-14:/zai-jing-tai-han-shu-zhong-shi-yong-ni-ming-lei-ke-bi-mian-nei-cun-xie-lou.html</guid></item><item><title>Activity.isFinishing()</title><link>http://seven332.github.io/activityisfinishing.html</link><description>&lt;p&gt;&lt;code&gt;Activity.isFinishing()&lt;/code&gt; 挺有用的，可以在 &lt;code&gt;onDestroy()&lt;/code&gt; 里来判断 Activity 是真的要关闭还是只是要重新创建，方便资源释放。之前没想到这个，用了麻烦的方法来实现功能，翻源码才想起了这个。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Thu, 22 Sep 2016 01:35:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2016-09-22:/activityisfinishing.html</guid></item><item><title>移植 7-Zip-JBinding 到 Android</title><link>http://seven332.github.io/yi-zhi-7-zip-jbinding-dao-android.html</link><description>&lt;p&gt;近期一直在做 7-Zip-JBinding 到 Android 的移植，目前算是完成了。7-Zip-JBinding 对 7-Zip 的封装完成度很高。不过在移植过程中还是遇到过一些问题。&lt;/p&gt;
&lt;p&gt;首先是创建 7z 格式压缩文件的时候会出现 native crash。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;JNI DETECTED ERROR IN APPLICATION: use of invalid jobject 0x7f49b9dd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;一般来说，&lt;code&gt;invalid jobject&lt;/code&gt; 是 0x00000000，也就是 &lt;code&gt;NULL&lt;/code&gt;，不过这里不是，那么就是别的问题。调了下发现是在别的线程里出现的这个问题，那么就应该是没有创建 global references 的问题。加上后就好了。&lt;/p&gt;
&lt;p&gt;修改后依然有 native crash，调了下发现是有个 &lt;code&gt;jclass&lt;/code&gt; 为 &lt;code&gt;NULL&lt;/code&gt;。为啥 &lt;code&gt;env- …&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Wed, 25 May 2016 19:04:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2016-05-25:/yi-zhi-7-zip-jbinding-dao-android.html</guid></item><item><title>UnsatisfiedLinkError: dlopen failed: has text relocations</title><link>http://seven332.github.io/unsatisfiedlinkerror-dlopen-failed-has-text-relocations.html</link><description>&lt;p&gt;有人说 Nimingban 在 Android 6.0 下闪退，我感觉很奇怪，因为我用的就是 Android 6.0，而且使用正常。于是我在 Android 6.0 x86 的虚拟机上跑了下，果然闪退了。错误是这样的&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;java.lang.UnsatisfiedLinkError: dlopen failed: xxx.so: has text relocations
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;搜索了下发现了&lt;a href="http://slowbutdeadly.blogspot.jp/2015/09/javalangunsatisfiedlinkerror-dlopen.html"&gt;这个&lt;/a&gt;。根据他的描述，使用最新的 NDK 就可以解决这个问题，而我使用就是最新的 NDK，结果还是在 x86 上出了问题。那么应该是平台问题了。&lt;/p&gt;
&lt;p&gt;看看这个问题，说的是 has text relocations，这个问题似乎在以前的 Android …&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Tue, 08 Mar 2016 22:21:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2016-03-08:/unsatisfiedlinkerror-dlopen-failed-has-text-relocations.html</guid></item><item><title>修正 autoconf 中出现的错误</title><link>http://seven332.github.io/xiu-zheng-autoconf-zhong-chu-xian-de-cuo-wu.html</link><description>&lt;p&gt;有时跑 autoconf 会出现类似&lt;code&gt;error: possibly undefined macro: XXX&lt;/code&gt;的问题。我在&lt;a href="https://bbs.archlinux.org/viewtopic.php?id=161452"&gt;这里&lt;/a&gt;看到了解决方法。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ libtoolize --force
$ aclocal
$ autoheader
$ automake --force-missing --add-missing
$ autoconf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样就好了。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Sun, 07 Feb 2016 23:34:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2016-02-07:/xiu-zheng-autoconf-zhong-chu-xian-de-cuo-wu.html</guid></item><item><title>ValueAnimator.pause() 内存泄漏</title><link>http://seven332.github.io/valueanimatorpause-nei-cun-xie-lou.html</link><description>&lt;p&gt;ValueAnimator.pause() 在 API 19 引入，若不正确使用会导致严重内存泄漏。&lt;/p&gt;
&lt;p&gt;以前有些使用 ValueAnimator.stop() 的地方在 API 19 及以后可以使用 ValueAnimator.pause() 替代来达到更好的效果。但是若在调用 ValueAnimator.pause() 之后就放弃了 ValueAnimator 实例的话，这个 ValueAnimator 实例会一直被 ValueAnimator.AnimationHandler 占有，从而导致内存泄漏。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Mon, 18 Jan 2016 12:04:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2016-01-18:/valueanimatorpause-nei-cun-xie-lou.html</guid></item><item><title>Android 下编译 libjpeg-turbo</title><link>http://seven332.github.io/android-xia-bian-yi-libjpeg-turbo.html</link><description>&lt;p&gt;以前就移植过 libjpeg-turbo，这次又下载了最新的源码重新移植了一遍，发现在以前移植过程中有不好的做法，同时也出现了新的问题。&lt;/p&gt;
&lt;p&gt;源码可以在&lt;a href="https://github.com/seven332/seven332.github.io"&gt;这里&lt;/a&gt;找到。&lt;/p&gt;
&lt;p&gt;移植的过程基本就是把 Makefile 转为 Android.mk 的过程，当然其中会出现不少问题。同时所需要的只有解码部分，所以要把编码部分的源码剔除。&lt;/p&gt;
&lt;p&gt;libjpeg-turbo 与 libjpeg 最大的区别在于 libjpeg-turbo 有不少汇编代码。Android 也是有多个硬件平台，可以与其汇编代码对应起来。具体各个平台需要哪些源码直接看&lt;a href="https://github.com/seven332/libjpeg-turbo/blob/master/Android.mk"&gt;这里&lt;/a&gt;好了，值得注意的是并不所有的 Android 硬件平台 libjpeg-turbo 都提供了汇编代码，对于那些没有被照顾到的硬件平台就添加 jsimd_none.c 文件。&lt;/p&gt;
&lt;p&gt;接下来是遇到的问题，x86_64 编译会出现问题&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;***/jni/libjpeg-turbo/simd/jccolext-sse2-64.asm:50: error: redefinition of …&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Wed, 21 Oct 2015 23:47:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2015-10-21:/android-xia-bian-yi-libjpeg-turbo.html</guid></item><item><title>resolveActivity 的重要性</title><link>http://seven332.github.io/resolveactivity-de-zhong-yao-xing.html</link><description>&lt;p&gt;在 Android Developers 发的视频 &lt;a href="https://www.youtube.com/watch?v=HGElAW224dE"&gt;Protecting Implicit Intents with Runtime Checks (Android Development Patterns Ep 1)&lt;/a&gt; 中看到了自己以前犯过的一个错误，就是没有处理 Implicit Intents 导致的 ActivityNotFoundException 异常。&lt;/p&gt;
&lt;p&gt;每当需要用 Implicit Intents 的时候我就会想，用户不可能连这个都没装吧，这是 Android L 的新特性，有系统应用支持肯定不会有问题的。结果都出问题了。可能是用户真的没有安装这类应用，譬如用户用的是模拟器什么类的特殊平台，或者有什么权限的限制。看到错误日志之后，我就直接获取 ActivityNotFoundException，然后忽略。但这并不是一个好的处理方式，因为 ActivityNotFoundException 继承的是 RuntimeException。没有人会不做边界检查直接捕获 IndexOutOfBoundsException。这时候 &lt;a href="http://developer.android.com/reference/android/content/pm/PackageManager.html#resolveActivity(android.content.Intent, int)"&gt;resolveActivity&lt;/a&gt; 的重要性就体出来了 …&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Thu, 08 Oct 2015 21:18:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2015-10-08:/resolveactivity-de-zhong-yao-xing.html</guid></item><item><title>SwitchPreference 在 pre-L 下的 bug</title><link>http://seven332.github.io/switchpreference-zai-pre-l-xia-de-bug.html</link><description>&lt;p&gt;在 &lt;a href="https://github.com/seven332/Nimingban"&gt;Nimingban&lt;/a&gt; 这个应用中，最开始我是把暗色主题用 SwitchPreference 放在设置界面里的，而且是第一项。后来有用户反馈说是把设置往下滑动，会出现界面闪烁。我听后感觉很奇怪，因为我这不能重现这个 bug，而且设置界面这方面的代码我也没有用什么奇技淫巧，想必不太可能是我的锅。既然不是我的锅那么就是系统的锅了。好在这个问题貌似只是几个用户会遇到，我也就没太注意，直接在设置中删掉暗色主题的设置，移到右侧栏的下面，自认为完美地解决了这个问题。&lt;/p&gt;
&lt;p&gt;后来又看到有用户反馈说随着设置界面的滑动，设置项的值会变化。看来这个问题并没有被解决。想想看肯定还是系统的问题。查询了一番果然是系统的问题，而且 lollipop 以下的都有这个问题。这个问题已经有人在 stackoverflow 上&lt;a href="http://stackoverflow.com/questions/15632215/preference-items-being-automatically-re-set"&gt;问了&lt;/a&gt;，而且提交了 &lt;a href="https://code.google.com/p/android/issues/detail?id=26194"&gt;issue&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;问题的原因在提交的 issue 里描述的很清楚。PreferenceFragment 用的是 ListView，ListView 会对控件重复使用，问题就出现在重复使用的过程中。&lt;/p&gt;
&lt;p&gt;kitkat-mr2.2-release (API 19) SwitchPreference 相关片段&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;private …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Tue, 29 Sep 2015 16:15:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2015-09-29:/switchpreference-zai-pre-l-xia-de-bug.html</guid></item><item><title>Android DateFormat 关于小时的解析</title><link>http://seven332.github.io/android-dateformat-guan-yu-xiao-shi-de-jie-xi.html</link><description>&lt;p&gt;这是以前写的文章。&lt;/p&gt;
&lt;p&gt;这是以前遇到的问题，具体可以在&lt;a href="https://github.com/seven332/EhViewer/issues/16"&gt;这里&lt;/a&gt;看到。今天不想做别的事所以又研究了下。&lt;/p&gt;
&lt;p&gt;我本来是想弄个显示时间的控件，记得 Android 本身就有个 TextClock 就直接拿过来用了。结果这个是 JELLY_BEAN_MR1（API 17） 的时候加入的。为了兼容旧的 Android 本版，我直接把 TextClock 的代码拷贝了一份修改了下就能用了。&lt;/p&gt;
&lt;p&gt;后来有看到别人发的截图，时间显示的是 HH:什么什么。我当时没有注意。后来有人发个了 issue，我才开始注意这个问题。&lt;/p&gt;
&lt;p&gt;JELLY_BEAN_MR1（API 17） TextClock 默认解析格式是&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;CharSequence&lt;/span&gt; &lt;span class="n"&gt;DEFAULT_FORMAT_12_HOUR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;h:mm aa&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;CharSequence&lt;/span&gt; &lt;span class="n"&gt;DEFAULT_FORMAT_24_HOUR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;k …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Tue, 29 Sep 2015 15:00:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2015-09-29:/android-dateformat-guan-yu-xiao-shi-de-jie-xi.html</guid></item><item><title>Hello World</title><link>http://seven332.github.io/hello-world.html</link><description>&lt;p&gt;还是要写点东西，对自己对其他人都有好处。以前也准备弄个博客，可是代码显示怎么也弄不好。当时用的是 Jekyll，ruby 我也看不懂，一不爽就不弄了。现在用的是 Pelican，python 的话至少还是看的懂的，平时会用她写些小东西。代码显示方面也没怎么配置直接就能用了。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hippo</dc:creator><pubDate>Tue, 29 Sep 2015 14:32:00 +0800</pubDate><guid isPermaLink="false">tag:seven332.github.io,2015-09-29:/hello-world.html</guid></item></channel></rss>